<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta productName="viewport" content="width=device-width, initial-scale=1.0">
    <title>테스트</title>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script type="text/javascript">
        const acaoUrl = "https://cors-anywhere.herokuapp.com/";
        const baseUrl = "http://openapi.11st.co.kr/openapi/OpenApiService.tmall";
        const apiKey = "d31cb5254083f025e9231e22960e7e14";
        let keyword = "xnote";
        let url = acaoUrl + baseUrl
            + "?key=" + apiKey
            + "&apiCode=ProductSearch&keyword=" + keyword;

        $(document).ready(function () {
            console.log("ready");
            $("#btnSearch").on("click", function () {
                /* $.ajax({
                    method: "GET",
                    datatype: "json",
                    url: url,
                }).done(function (msg) {
                    var str = msg.document["ProductSearchResponse"]["Products"]["Product"][0]["ProductproductName"];
                    $("p").append(msg);
                    console.log(msg);
                }); */
                let xhr = new XMLHttpRequest();

                xhr.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        setResult(this); //this == xhr  ***********
                    }
                }
                xhr.open("GET", url, true);
                xhr.send();
                function setResult(xml) { //open API xml 받음
                    let productName, productTemp;
                    let txtPName, txtTemp, xmlDoc;

                    txtPName = txtTemp = ""; //초기화
                    xmlDoc = JSON.parse(xhr.responseText);//xml.responseXML;
                    console.log(xmlDoc);
                    //const result = JSON.parse(xhr.responseText);
                    /*
                    productTemp = xmlDoc.getElementsByTagproductName("ProductCode");
                    productName = xmlDoc.getElementsByTagproductName("ProductName");
                    productName = xmlDoc["Product"]["ProductName"];

                     for(var i=0; i < productName.length; i++){ //productName.length
                        //txtTemp = productTemp[i].childNodes[0].nodeValue;
                        txtPName = productName[i].childNodes[0].nodeValue;
                        let html = "<li>"+txtPName+"</li>";//+"<li>"+txtTemp+"</li>";
                        $("#productList").append(html);
                    } */
                }
            });
        });
    </script>
</head>

<body>
    <h1>Test HTML code</h1>
    <form method="post" action="/process/products">
        <input type="text" productName="searchKeyword" />
        <input type="button" id="btnSearch" value="검색" />
    </form>
    <div id="productList"></div>
</body>

</html>